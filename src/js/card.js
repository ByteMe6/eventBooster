import debounce from 'debounce';
import axios from 'axios';

document.addEventListener('DOMContentLoaded', searchDataOnLoad);

let searchInput = document.querySelector('.searchInput');
let searchInputValue = 'Shit';

// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹
async function searchDataOnLoad() {
  let dataFromAxios = await axios.get(
    `https://app.ticketmaster.com/discovery/v2/events.json?apikey=GuFBpVgQ1pTfyV0ZT9FA4QxjKXxhnZzD&keyword=${searchInputValue}`
  );
  console.log(dataFromAxios);
}

function collectInpupData() {
  searchInputValue = document.querySelector('.searchInput').value;
  console.log(searchInputValue);

  searchData();
}

searchInput.addEventListener('input', debounce(collectInpupData, 500));

// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ¿Ğ¾ ĞºĞ»ÑÑ‡ĞµĞ²Ğ¾Ğ¼Ñƒ ÑĞ»Ğ¾Ğ²Ñƒ
async function searchData() {
  try {
    let dataFromAxios = await axios.get(
      `https://app.ticketmaster.com/discovery/v2/events.json?apikey=GuFBpVgQ1pTfyV0ZT9FA4QxjKXxhnZzD&keyword=${searchInputValue}`
    );

    let events = dataFromAxios.data._embedded.events;
    console.log(events);

    createCard(events);
  } catch (error) {
    console.error('Error fetching event data:', error);
  }
}

// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞµĞº Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑĞ¼Ğ¸
function createCard(arr) {
  try {
    const main = document.querySelector('.main');
    main.innerHTML = ""; // ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ¿ĞµÑ€ĞµĞ´ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸ĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ñ… ĞºĞ°Ñ€Ñ‚

    const cards = arr.map(e => {
      let title = e.name || "No title available";
      let date = e.dates?.start?.localDate || "No date available";
      let loc = e._embedded?.venues[0]?.name || "No location available";
      let src = e.images?.[0]?.url || "https://via.placeholder.com/150";

      return `
        <div class="card" data-event='${JSON.stringify(e)}'>
          <img class="cardImg" src="${src}" alt="Event image" />
          <h3 class="cardTitle">${title}</h3>
          <p class="cardDate"><span class="cardDateIcon"> ğŸ—“ï¸ </span> ${date}</p>
          <p class="cardLocation"><span class="cardLocIcon"> ğŸ“ </span> ${loc}</p>
        </div>`;
    });

    main.innerHTML = cards.join(""); // Ğ’ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ ĞºĞ°Ñ€Ñ‚Ñ‹ Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€

    // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ»ÑƒÑˆĞ°Ñ‚ĞµĞ»ÑŒ Ğ´Ğ»Ñ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ Ğ¼Ğ¾Ğ´Ğ°Ğ»ĞºĞ¸
    const cardElements = document.querySelectorAll('.card');
    cardElements.forEach(card => {
      card.addEventListener('click', (e) => {
        const eventData = JSON.parse(e.currentTarget.getAttribute('data-event'));
        openModal(eventData);
      });
    });
  } catch (error) {
    console.error("Error creating cards:", error);
    const main = document.querySelector('.main');
    main.innerHTML = `<p>Failed to load events. Please try again later.</p>`;
  }
}


